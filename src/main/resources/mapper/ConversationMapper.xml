<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zzzlew.zzzimserver.mapper.ConversationMapper">

    <select id="selectListByUserIdAndConversationIdList"
            resultType="com.zzzlew.zzzimserver.pojo.vo.conversation.ConversationVO">
        select * from conversation c where c.user_id = #{userId} and c.id in
        <foreach collection="conversationIdList"
                 item="cId"
                 open="("
                 close=")"
                 separator=",">
            #{cId}
        </foreach>
    </select>

    <update id="updateConversationStatus">
        update conversation
        set latest_msg      = #{content},
            latest_msg_time = #{sendTime},
            status          = 1,
            unread_count    = CASE
                                  WHEN user_id = #{receiverId}
                                      THEN unread_count + 1
                                  ELSE unread_count
                END
        where id = #{conversationId}
    </update>

</mapper>